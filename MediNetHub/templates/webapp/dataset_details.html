{% extends 'base.html' %}
{% load humanize %}

{% block title %}Dataset Details - {{ dataset.dataset_name }}{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4">
    <!-- Header con navegación -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2><i class="fas fa-search me-2"></i>Dataset Details</h2>
            <p class="text-muted">Comprehensive analysis and metrics</p>
        </div>
        <div>
            <a href="{{ back_url }}" class="btn btn-primary" style="border-radius: 8px;">
                <i class="fas fa-arrow-left me-2"></i>Back to Datasets
            </a>
        </div>
    </div>

    <!-- Compact Dataset Header - Full Width -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body py-3">
                    <div class="card-header bg-primary text-white mb-3" style="margin: -1rem -1rem 1rem -1rem; border-radius: 0.375rem 0.375rem 0 0;">
                        <h6 class="mb-0">
                            {% if dataset_type == 'tabular' %}
                                <i class="fas fa-table me-2"></i>
                            {% elif dataset_type == 'image_classification' or dataset_type == 'image_segmentation' %}
                                <i class="fas fa-images me-2"></i>
                            {% elif dataset_type == 'text' %}
                                <i class="fas fa-file-alt me-2"></i>
                            {% elif dataset_type == 'time_series' %}
                                <i class="fas fa-chart-line me-2"></i>
                            {% endif %}
                            {{ dataset.dataset_name }}
                        </h6>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-3">
                            <p class="text-muted mb-1 small">
                                <i class="fas fa-hospital me-1"></i>
                                <strong>Connection:</strong> {{ dataset.connection.name }}
                            </p>
                            <p class="text-muted mb-1 small">
                                <i class="fas fa-network-wired me-1"></i>
                                {{ dataset.connection.ip }}:{{ dataset.connection.port }}
                            </p>
                        </div>
                        <div class="col-md-3">
                            {% if dataset.medical_domain %}
                            <p class="text-muted mb-1 small">
                                <i class="fas fa-heartbeat me-1"></i>
                                <strong>Domain:</strong> {{ dataset.medical_domain }}
                            </p>
                            {% endif %}
                            {% if dataset.target_column %}
                            <p class="text-muted mb-1 small">
                                <i class="fas fa-crosshairs me-1"></i>
                                <strong>Target:</strong> {{ dataset.target_column }}
                            </p>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <p class="text-muted mb-1 small">
                                <i class="fas fa-database me-1"></i>
                                <strong>Samples:</strong> {{ dataset.patient_count|intcomma }}
                            </p>
                            <p class="text-muted mb-1 small">
                                <i class="fas fa-hdd me-1"></i>
                                <strong>Size:</strong> {{ dataset.file_size|filesizeformat }}
                            </p>
                        </div>
                        <div class="col-md-3">
                            <div class="d-flex flex-wrap gap-2">
                                <span class="badge bg-secondary">{{ dataset.data_type|default:"Tabular" }}</span>
                                <span class="badge bg-info">{{ dataset.num_columns }} cols</span>
                                <span class="badge bg-success">CSV</span>
                            </div>
                        </div>
                    </div>

                    <!-- Compact Quality Metrics -->
                    <div class="mt-4">
                        <h6 class="text-muted mb-3"><i class="fas fa-chart-bar me-2"></i>Quality Metrics</h6>
                        <div class="row g-3">
                            <div class="col-md-3">
                                <div class="text-center p-3" style="background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%); border-radius: 12px;">
                                    <div class="mb-1">
                                        <i class="fas fa-shield-alt" style="font-size: 1.2rem; color: #0288d1;"></i>
                                    </div>
                                    <div class="h5 fw-bold mb-1" style="color: #0288d1;">
                                        {% if dataset.quality_score %}
                                            {{ dataset.quality_score|floatformat:0 }}%
                                        {% else %}
                                            100%
                                        {% endif %}
                                    </div>
                                    <small class="text-dark">Data Quality</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3" style="background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%); border-radius: 12px;">
                                    <div class="mb-1">
                                        <i class="fas fa-check-circle" style="font-size: 1.2rem; color: #0288d1;"></i>
                                    </div>
                                    <div class="h5 fw-bold mb-1" style="color: #0288d1;">
                                        {% if dataset.completeness_percentage %}
                                            {{ dataset.completeness_percentage|floatformat:0 }}%
                                        {% else %}
                                            100%
                                        {% endif %}
                                    </div>
                                    <small class="text-dark">Completeness</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3" style="background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%); border-radius: 12px;">
                                    <div class="mb-1">
                                        <i class="fas fa-info-circle" style="font-size: 1.2rem; color: #0288d1;"></i>
                                    </div>
                                    <div class="h5 fw-bold mb-1" style="color: #0288d1;">0</div>
                                    <small class="text-dark">Missing Values</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3" style="background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%); border-radius: 12px;">
                                    <div class="mb-1">
                                        <i class="fas fa-lock" style="font-size: 1.2rem; color: #0288d1;"></i>
                                    </div>
                                    <div class="h5 fw-bold mb-1" style="color: #0288d1;">K-Anon</div>
                                    <small class="text-dark">Privacy Protected</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Métricas según tipo de dataset -->
    {% if dataset_type == 'tabular' %}
        {% include 'webapp/dataset_details/tabular_metrics.html' %}
    {% elif dataset_type == 'image_classification' %}
        {% include 'webapp/dataset_details/image_classification_metrics.html' %}
    {% elif dataset_type == 'image_segmentation' %}
        {% include 'webapp/dataset_details/image_segmentation_metrics.html' %}
    {% elif dataset_type == 'text' %}
        {% include 'webapp/dataset_details/text_metrics.html' %}
    {% elif dataset_type == 'time_series' %}
        {% include 'webapp/dataset_details/time_series_metrics.html' %}
    {% else %}
        {% include 'webapp/dataset_details/default_metrics.html' %}
    {% endif %}

</div>

<!-- Custom styles for dataset details -->
<style>
.metrics-card {
    transition: transform 0.2s ease-in-out;
}

.metrics-card:hover {
    transform: translateY(-2px);
}

.balance-bar {
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
    background-color: #e9ecef;
}

.balance-segment {
    height: 100%;
    float: left;
    transition: width 0.3s ease;
}

.metric-icon {
    font-size: 1.5rem;
    opacity: 0.7;
}

.quality-score {
    font-size: 2rem;
    font-weight: bold;
}

.recommendation-list {
    list-style: none;
    padding: 0;
}

.recommendation-list li {
    padding: 0.25rem 0;
    border-left: 3px solid #007bff;
    padding-left: 0.75rem;
    margin-bottom: 0.5rem;
    transition: border-color 0.2s ease;
}

.recommendation-list li:hover {
    border-color: #0056b3;
    background-color: rgba(0, 123, 255, 0.05);
}

@media (max-width: 768px) {
    .metrics-grid {
        grid-template-columns: 1fr !important;
    }
}
</style>

{% endblock %}